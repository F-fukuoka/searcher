<!DOCTYPE html>
<html lang="ja">
<head>
    <link href='main.css' rel="stylesheet" type="text/css">
    
    <meta charset="UTF-8">
    <title>口癖searcher</title>
</head>
<body>

    <h1>口癖Searcher</h1>
    <h3>~使い方~<br>
      ①STARTを押す<br>
      ②STOPを押す<br>
      ③検出したい口癖を入力<br>
      ④Searchを押す<br>
      ⑤SAVEを押して保存<br>
      ※マイクを近づけて話してください<br>
      ※沈黙だと自動停止するので、もう一度STARTを押す
    </h3>


    <div class="bt"><span>
        <input type="button" class="b1" id="btn" value="START" onclick="st(this)">
        <input type="button" class="b2" id="btn2" value="SAVE" onclick="window.open('https://docs.google.com/document/u/0/')">
             </span>
    </div>
    <div class="kensaku" ><br>
        <input type="text"  class="textb1" id="k1" placeholder="えー">
        <input type="text"  class="textb2" id="k1" placeholder="なるほど"><br>
        <input type="text"  class="textb3" id="k1" placeholder="そうですね">
        <input type="text"  class="textb4" id="k1" placeholder="ていうか"><br>
        <input type="text"  class="textb5" id="k1" placeholder="あの">
        <input type="text"  class="textb6" id="k1" placeholder="それは"><br>
        <input type="text"  class="textb7" id="k1" placeholder="えっと">
        <input type="text"  class="textb8" id="k1" placeholder="なんか"><br>
        <input type="text"  class="textb9" id="k1" placeholder="口癖">
        <input type="text"  class="textb10" id="k1" placeholder="口癖"><br>
     </div><br>

       <div class="butn">
        <input type="button" class="b3" id="btn3" value="Search" onclick="ng(this)">
   </div>
      <br>
      <!--上のtextbox-->
       <div id="result" 
        style="padding: 10px; margin-bottom: 10px;
        border: 5px double #333333; border-radius: 10px;" class="text" onclick="func(this)"></div>
        <!--下のtextbox-->
        <div id="result-div"
        style="padding: 10px; margin-bottom: 10px;
        border: 5px double #333333; border-radius: 10px;" class="text2"></div>
    <!--文字化したものを表示-->
    <!--html終了 画面レイアウト-->

<script>
    const btn = document.querySelector('#btn');//START,STOPボタンの定義
    const btn2 = document.querySelector('#btn2');//SAVEボタンの定義
    const btn3 = document.querySelector('#btn3');
    const result=document.querySelector('#result');
    const resultDiv = document.querySelector('#result-div');//音声を文字化したもの(text2)の定義
    

    //音声認識と文字化
    SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
    let recognition = new SpeechRecognition();
  
    recognition.lang = 'ja-JP';
    recognition.interimResults = true;//音声認識しっぱなしにする(ただし、沈黙が続くと終了)
    recognition.continuous = true;
  
    let finalTranscript = ''; // 確定した(黒の)認識結果
  
    recognition.onresult = (event) => {
      let interimTranscript = ''; // 暫定(灰色)の認識結果
      for (let i = event.resultIndex; i < event.results.length; i++) {
        let transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalTranscript += transcript;
        } else {
          interimTranscript = transcript;
        }
      }
      resultDiv.innerHTML = finalTranscript + '<i style="color:#ddd;">' + interimTranscript + '</i>';
    }

//START,STOPボタンの統一
  function st(Button){
if( Button.value == "START" ){
  recognition.start();
  Button.value = "STOP";
  return;
  }
if( Button.value == "STOP" ){
  recognition.stop();
  Button.value = "START";
  return;
  }
}
  
 //searchボタンを押したら、回数を検出
  function ng(Button){
 var kousei = document.getElementById('k1').value;
 var target = kousei;
 var count = "3";
  document.write.innerHTML(kousei + "が" + count +"回検出されました");
//alert(kousei); 

}

  </script>
  </body>
  </html>