<!DOCTYPE html>
<html lang="ja">
<head>
    <link href='main.css' rel="stylesheet" type="text/css">
    <meta charset="UTF-8">
    <title>口癖searcher</title>
</head>
<body>
    <h1>口癖searcher</h1>
    <div class="bt"><span>
        <button type="button" class="b1" id="btn" value="submit">
           <font>START</font>
        </button>
        <button type="button" class="b2" id="btn2" value="submit">
           <font>STOP</font>
        </button>
        <button type="button" class="b3" id="btn3" value="submit">
           <font>SAVE</font>
        </button>
             </span>
    </div>
             <div id="result"
        style="padding: 10px; margin-bottom: 10px;
        border: 5px double #333333; border-radius: 10px;" class="text">口癖が〇回検出されました！</div>
             
             <div id="result-div"
        style="padding: 10px; margin-bottom: 10px;
        border: 5px double #333333; border-radius: 10px;" class="text2"></div>
    <!--文字化したものを表示-->
    <!--html終了　画面レイアウト-->

<script>
    const btn = document.querySelector('#btn');
    const btn2 = document.querySelector('#btn2')
    const btn3 = document.querySelector('#btn3')
    const resultDiv = document.querySelector('#result-div');

        var flag_speech = 0;
 
        function vr_function() {
            window.SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
            var recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.interimResults = true;
            recognition.continuous = true;

            let finalTranscript = ''; // 確定した(黒の)認識結果
 
            recognition.onresult = (event) => {
      let interimTranscript = ''; // 暫定(灰色)の認識結果
//                var results = event.results;
    for (let i = event.resultIndex; i < event.results.length; i++) {
        let transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal){
                        document.getElementById('result_text').innerHTML = finalTranscript += transcript;
                        vr_function();
                    } else {
                        resultDiv.innerHTML = finalTranscript + '<i style="color:#ddd;">' + interimTranscript.transcript + '</i>';
                        flag_speech = 1;
                    }
                }
            }
            flag_speech = 0;
            btn.onclick = () => {
                recognition.start();
            }
            btn2.onclick = () => {
            recognition.stop();
            }
        }
  </script>
  </body>
</html>